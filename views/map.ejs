<!DoCTYPE html>
<html>
	<head> 
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" /> 
		<title>Google Maps Multiple Markers</title> 
		<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<!-- DataTables CSS -->
		<link rel="stylesheet" type="text/css" href="/css/jquery.dataTables.min.css">
  
<!-- jQuery -->
		<script type="text/javascript" charset="utf8" src="/js/jquery.js"></script>
  
<!-- DataTables -->
		<script type="text/javascript" charset="utf8" src="/js/jquery.dataTables.min.js"></script>
	</head>
	<body>
		<div>
			<table><tr><td valign="top">
				<div id="list" style="width: 200px; height: 300px">
					<h4>List of Studies</h4>
					<ul id='list'></ul>	
				</div>
				<div id="sampleScroll" style = "width: 200px; height: 300px; overflow-y:scroll;">
				</div>
			</td><td valign="top">
				<div id="map" style="width:1000px;height:600px;"></div>
			</td></tr></table>
		</div>
		<div id= "data" style = "padding-left:200px;width:1000px;">
		</div>
	</body>

	<script type="text/javascript">


		var map = new google.maps.Map(document.getElementById('map'), {
			zoom: 10,
			center: new google.maps.LatLng(36, -84.2),
			mapTypeId: google.maps.MapTypeId.TERRAIN
		});
	
		$.get( "/study/data",
			function( studies ) {
				for(var i = 0; i< studies.length; i++) {
					var studyIdWOU = studies[i].studyId.replace(/_/g,' ');
				$('#list').append('<li>' +  '<a href="javascript:void(0);" onclick="getPoints(\''+studies[i]._id +'\');">' + studyIdWOU + '</a>' + '</li>');
				}
			}
		);
		
		
		$(function() {
			getPoints = function(id){
					document.getElementById("data").innerHTML = "";
				var table ='<table id=studySample><thead><tr><th>Sample Name</th></tr></thead><tbody>';
				var map = new google.maps.Map(document.getElementById('map'), {
					zoom: 10,
					mapTypeId: google.maps.MapTypeId.TERRAIN
				});

			$.get( "/map/data/"+id, function( data ) {
				gmarkers= [];
				var marker, i;
				for (i = 0; i < data.length; i++) { 
					if (i == 0){
						map.setCenter(new google.maps.LatLng(data[i].latitude, data[i].longitude));
						}
						table = table + '<tr><td><a href = "javascript:google.maps.event.trigger(gmarkers[\''+data[i].sampleId+'\'], \'click\')">'+data[i].sampleId+'</a></td></tr>';
					}
				table = table + '</tbody></table>';
		document.getElementById("sampleScroll").innerHTML = table;
		$('#studySample').dataTable();
		var infowindow = new google.maps.InfoWindow();
					for(var n=0; n< data.length; n++){
						gmarkers[data[n].sampleId] = createMarker( new google.maps.LatLng(data[n].latitude, data[n].longitude), 
								'<b> ID:  </b>' + data[n].sampleId + '</br>'
								+ '<b> Name: </b> ' + data[n].sampleName + '</br>' 
								+ '<b> Sampling Date: </b> ' + data[n].samplingDate + '</br>' 
								+ '<b> Domain: </b> ' + data[n].domain + '</br>' 
								+ '<b> Analysis Type: </b> ' + data[n].analysisType + '</br>' 
								+ '<b> Ecosystem Subtype: </b> ' + data[n].ecosystemSubtype + '</br>' 
								+ '<b> Host Name: </b> ' + data[n].hostName + '</br>' 
								+ '<b> Host Tissue: </b> ' + data[n].hostTissue + '</br>' 
								+ '<b> Taxonomy ID: </b> ' + data[n].taxonId + '</br>' 
								+ '<a href="javascript:void(0);" onclick="showDetails(\''+data[n]._id +'\');">Details</a>', infowindow, data[n])
						}
			}
	);
	$(function(){
		createMarker = function(latlng, html, infowindow, data) {
	    var marker = new google.maps.Marker({
					        position: latlng,
									        map: map,
													title: data.sampleId
													    });
	google.maps.event.addListener(marker, 'click', function() {
							        infowindow.setContent(html);
											        infowindow.open(map, marker);
			   		
					document.getElementById("data").innerHTML = "";
															    });
					return marker;
		}
	});
}});
	</script>
	<script>
		$(function() {
		  showDetails = function(data) { 
			document.getElementById("data").innerHTML = 
			'<a href="javascript:void(0);" onclick="getForecast(\''+ data +'\');">Forecast</a>' + '</br>'
			+ '<a href="javascript:void(0);" onclick="getMetadata(\''+ data +'\');">Get Metadata</a>' + '</br>'
			+ '<a href="javascript:void(0);" onclick="getSoil(\''+ data +'\');">Get Soil Data</a>' + '</br>'
				+ '<a href="javascript:void(0);" onclick="getSpecies(\''+ data +'\');">Get Species Details</a>';
				
			};
		});
		$(function() {
		  getForecast = function(id) {
				$.get('sample/data/' + id, function(data){
				var latitude =data[0].latitude; 
				var longitude = data[0].longitude;
				var samplingDate = data[0].samplingDate; 
 

					$.get("/forecast/" + latitude + "/" + longitude + "/" + samplingDate,
						function(weather) {
							document.getElementById("data").innerHTML =
								 '<a href="javascript:void(0);" onclick="getMetadata(\''+ data +'\');">Get Metadata</a>' + '</br>'
					                        + '<a href="javascript:void(0);" onclick="getSoil(\''+ data +'\');">Get Soil</a>' + '</br>'
                               					+ '<a href="javascript:void(0);" onclick="getSpecies(\''+ data +'\');">Get Species</a>' + '</br>'
								+ '<b> Looked Like: </b>' + weather.currently.summary + '</br>'
								+ '<b> Percent Chance Rain </b>' + weather.currently.precipProbability + '</br>'
								+ '<b> Temperature: </b>' + weather.currently.temperature + '</br>'
								+ '<b> Humidity </b>' + weather.currently.humidity + '</br>'
								+ '<b> Wind Speed </b>' + weather.currently.windSpeed +  '</br>'
								+ '<b> Pressure: </b>' + weather.currently.pressure + ' pascals </br>';

						}	
					)
				})};
		});
		
		$(function() { 
				getMetadata = function(id) {
					$.get('sample/data/' + id,
						function(data){
					document.getElementById("data").innerHTML = 
										 '<a href="javascript:void(0);" onclick="getForecast(\''+ data[0]._id +'\');">Forecast</a>' + '</br>'
										 + '<a href="javascript:void(0);" onclick="getSoil(\''+ data[0]._id +'\');">Get Soil Data</a>' + '</br>'
										 + '<a href="javascript:void(0);" onclick="getSpecies(\''+ data[0]._id +'\');">Get Species Details</a>'
				 						 + "<h5>" + data[0].sampleName +"</h5><br/>"
			               + '<b> Gold ID: </b> ' + data[0].sampleGoldId + '</br>' 
				             + '<b> Legacy Gold ID: </b> ' + data[0].sampleLegacyGoldId + '</br>' 
					           + '<b> Genome Size: </b> ' + data[0].sampleGemoneSize + '</br>' 
						         + '<b> Gene Count: </b> ' + data[0].sampleGeneCount + '</br>' 
						         + '<b> Scaffold Count: </b> ' + data[0].sampleScaffoldCount + '</br>' 
							       + '<b> Site ID: </b> ' + data[0].sideId + '</br>' 
							       + '<b> Latitude: </b> ' + data[0].latitude + '</br>' 
								     + '<b> Longitude: </b> ' + data[0].longitude + '</br>' 
								     + '<b> Altitude: </b> ' + data[0].altitude + '</br>' 
									   + '<b> DBH: </b> ' + data[0].dbh + ' cm' + '</br>' 
									   + '<b> Distance to River: </b> ' + data[0].distanceToRiver + ' m' + '</br>' 
										 + '<b> Distance to Populus: </b> ' + data[0].distanceToPopulus + ' m' + '</br>' 
										 + '<b> Distance to Roots: </b> ' + data[0].distanceToRoots + ' m' + '</br>' 
										 + '<b> Number of Proximal Trees: </b> ' + data[0].proximalTrees + '</br>' 
										 + '<b> Number of Proximal Poplar Trees: </b> ' + data[0].proximalPoplarTrees + '</br>' 
										 + '<b> Canopy Width: </b> ' + data[0].canopyWidth + ' m' + '</br>' 
										 + '<b> Basal Area: </b> ' + data[0].basalArea + ' m&sup2' + '</br>' 
										 + '<b> Basal Area per Hectare Tree: </b> ' + data[0].basalAreaPerHectareTree + '</br>' 
										 + '<b> Basal Area per Hectare Populus: </b> ' + data[0].basalAreaPerHectarePopulus + '</br>' 
										 + '<b> Basal Area Dominance: </b> ' + data[0].basalAreaDomincance + ' %' + '</br>';
						}
					)
				}
			});	
		$(function() {
				getSoil = function(id) {
					$.get('sample/data/' + id,
					function(data){
						document.getElementById("data").innerHTML = 
							'<a href="javascript:void(0);" onclick="getForecast(\''+ data[0]._id +'\');">Forecast</a>' + '</br>'
							+ '<a href="javascript:void(0);" onclick="getMetadata(\''+ data[0]._id +'\');">Get Metadata</a>' + '</br>'
							+ '<a href="javascript:void(0);" onclick="getSpecies(\''+ data[0]._id +'\');">Get Species Details</a>'
				 			+ "<h5>" + data[0].sampleName +"</h5><br/>"
							+ '<b> Soil Moisture: </b> ' + data[0].soilMoisture + ' %' + '</br>' 
							+ '<b> LBC 1 ppm CaCo3 pH: </b> ' + data[0].caco3 + '</br>' 
							+ '<b> pH CaCl2: </b> ' + data[0].cacl2 + '</br>' 
							+ '<b> Equivalent Water pH: </b> ' + data[0].waterPh + '</br>' 
							+ '<b> Sand: </b> ' + data[0].sand + ' %' + '</br>' 
							+ '<b> Silt: </b> ' + data[0].silt + ' %' + '</br>' 
							+ '<b> Clay: </b> ' + data[0].clay + ' %' + '</br>' 
							+ '<b> Carbon: </b> ' + data[0].carbon + ' %' + '</br>' 
							+ '<b> Nitrogen: </b> ' + data[0].nitrogen + ' %' + '</br>' 
							+ '<b> OM: </b> ' + data[0].oM + ' %' + '</br>' 
							+ '<b> Calcium: </b> ' + data[0].calcium + ' ppm' + '</br>' 
							+ '<b> Potassium: </b> ' + data[0].potassium + ' ppm' + '</br>' 
							+ '<b> Magnesium: </b> ' + data[0].magnesium + ' ppm' + '</br>' 
							+ '<b> Manganese: </b> ' + data[0].manganese + ' ppm' + '</br>' 
							+ '<b> Phosphorus: </b> ' + data[0].phosphorus + ' ppm' + '</br>' 
							+ '<b> Zinc: </b> ' + data[0].zinc + ' ppm' + '</br>';
					}
				)
			}
		});
	

		$(function() {
			getSpecies = function(id) {
				$.get("/details/" + id,
						function(species){
						var table = "" +
					'<table id = "details">'
					+'<thead><tr>'
					+ '<th> Species ID </th>'
					+ '<th> Kingdom </th>'
					+ '<th> Phylum </th>'
					+ '<th> Class </th>'
					+ '<th> Order </th>'
					+ '<th> Family </th>'
					+ '<th> Genus </th>'
					+ '<th> Species </th>'
					+ '<th> Abundance </th>'
					+ '</tr></thead><tbody>';
						
					for(var i=0; i< species.length; i++){
					
						table = table + '<tr>'
						+ '<td>'+ species[i].speciesId + '</td>'
						+ '<td>' + species[i].kingdom + '</td>'
						+ '<td>' + species[i].phylum + '</td>'
						+ '<td>' + species[i].sClass + '</td>'
						+ '<td>' + species[i].order + '</td>'
						+ '<td>' + species[i].family + '</td>'
						+ '<td>' + species[i].genus + '</td>'
						+ '<td>' + species[i].species + '</td>'
						+ '<td>' + species[i].abundance + '</td></tr>';
						}
						table = table + '</tbody></table>';
						document.getElementById("data").innerHTML =
							'<a href="javascript:void(0);" onclick="getForecast(\''+ id +'\');">Forecast</a>' + '</br>'
							+ '<a href="javascript:void(0);" onclick="getMetadata(\''+ id +'\');">Get Metadata</a>' + '</br>'
							+ '<a href="javascript:void(0);" onclick="getSoil(\''+ id +'\');">Get Soil Data</a>' + '</br>'
						  +	table;
						$('#details').dataTable();	
					});
			}
		});
	</script>
</html>

